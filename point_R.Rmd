---
output:
  word_document: default
  html_document: default
  pdf_document: default
---
# Triangular distribution

Prepare the document: Delete all the variables that were stored before.
```{r}
#clear all variables :
  rm(list = ls())
```


Create table with all relevant information. Our informations were taken from different sources. The data was given in probability distribution. In order to simplify the code and to get a point estimate, we took of the distributions the mean for normal distributions and the mode for triangular distributions. \n

The sources were the following:\n
- Petterson et al., 2016 (Triangular distributions)\n
- Schönning et al., 2006 (Normal distributions)\n

This informations can be updated according to your own sources. 
```{r}
df <- data.frame(
  duration_excretion = c(7, 7,1.6, 34, 15, 3.6, 10,2.0, 4.5,2.1),
  excretion_density = c(10^(10), 10^(10),exp(20.7), 10^(6), 10^(7.5), exp(3.8), 10^(7), exp(17.3),exp(15.0), exp(5.8)),  
  incidence_rate = c(0.88/100, 1.28/100,1200/100000, 2.4/100, 0.88/100, 500/100000, 1.28/100, 200/100000, 1100/100000, 30/100000),  
  row.names = c("adeno", "rota_triangular", "rota_normal", "campylo", "salmonella_triangular", "salmonella_normal", "crypto_triangular", "crypto_normal", "giardia", "EHEC")  
)

print(df)
```


Define the other parameters:\n
- X: Fictive population size. This parameter can be adapted according to population. For higher population samples, the variability of the results will be lower.\n
- rate: This value for the excretion has been taken as a mean value from the studies *To-Figueras et al., 2000*, *Balcells Gorina, 1989* and *Schouw et al, 2002*\n
- pathogens: In this list, we store the name of all the pathogens we listed in the table above\n
```{r}
X <- 500000             # fictive population size    
rate <- 250             # [g/cap/day] 

pathogens <- colnames(df)
```


## Production of feces

In population X, $incidence \times X$ persons are infected and $(1 - incidence) \times X$ persons are not infected during the whole year. When a person is not infected, he or she does not excrete the pathogen.


Production of not infected feaces [g/year] is devided into two subparts. For once, the production of the non infected feaces by the non infected population, where the formula is given here below. 
$$
rate \left[ \frac{g}{cap.day} \right] \times 365 \left[ \frac{days}{year} \right] \times (1 - \text{incidence}) \times X \left[ \text{cap} \right] = \text{production} \left[ g/year \right]
$$
On the other hand, we have the production of the non infected feaces by the infected population, during the time of the year when they are NOT infected. This is given through the formula:
$$
\text{rate} \left[ \frac{g}{cap.day} \right] \times (365 - \text{duration excretion} [\text{ days}]) = \text{production} \left[ g/year \right]
$$
The total production of non infected feaces is therefore the sum of the two. 
```{r}
production_non_infected_feaces_by_not_infected_pop <- rate * 365 * (1 - df["incidence_rate"]) * X

production_non_infected_feaces_by_infected_pop <- rate * (365- df["duration_excretion"]) * (df["incidence_rate"]) * X

df['production_non_infected_feaces'] <- production_non_infected_feaces_by_not_infected_pop + production_non_infected_feaces_by_infected_pop
```

Production of infected feaces by the part of the population that is infected is given through the equation:
$$
\text{rate} \left[ \frac{g}{cap.day} \right] \times \text{duration excretion}\left[ days \right] = \text{production} \left[ g/year \right]
$$
In the code, this is giving:
```{r}
df['production_infected_feaces'] <- rate * df["duration_excretion"] * (df["incidence_rate"]) * X
```


## Calculation of number and density of microorganism

The number of Microorganisms is calculated with help of the excretion density of the pathogens
$$
\text{production} \left[\frac{g}{year} \right]*  \text{excretion density} \left[\frac{nb.org}{g} \right] = \text{Nb organisms} \left[\frac{nb. org}{year} \right] 
$$

```{r}
df['nr_pathogens_total'] <- df['production_infected_feaces']*df['excretion_density']
```

The density of microorganisms ins the according number devided by the total number of feaces produced [Nr pathogens / g of feaces]. It is calculated by the formula:
$$
\text{average density} = \frac{\text{nb.org excreted in 1 year}}{\text{total infected feces}} \quad \left[ \frac{\text{nb.org excreted}}{\text{g feces in mixed pop}} \right]
$$

```{r}
df['density'] <- df['nr_pathogens_total'] / df['production_non_infected_feaces']
```


## Exposure pathway

Definition of parameters:
* t_hm: Transfer rate hand-mouth
* t_fh: Transfer rate fomite-hand
* t_gf: Transfer rate gloves-fomite
* t_exg: Transfer rate excreta-fomite
* a_gex: Area in contact between gloves and excreta
```{r}
t_hm <- 0.36 #[]
t_fh <- 0.43 #[]
t_gf <- 0.27 #[]
t_exg <- (0.16+0.28)/2 #[mg/cm^2]
a_gex <- (0.13+0.25)/2*420 #[cm^2]
```

We are using the equation we have seen in the Methods part:
$$
C_{Mf} = T_{H\rightarrow M} \times T_{F\rightarrow H} \times T_{G\rightarrow F} \times A_{GF} \times T_{Ex\rightarrow G} \times A_{GEx} \times C_{Ex}
$$

We first calculate the pathogen loss across the pathway, and combine it then with the densities. 
```{r}
ingestion_g <- t_exg*a_gex*t_fh*t_hm*t_gf
```

Calculation of number of pathogens ingested. We want to have the result in [nb. org.  / mg feces in mixed population], therefore we need to divide by 1000
```{r}
df['number_pathogens_ingested'] <- ingestion_g*df['density'] / 1000
print(df)
```


## Dose response models

For the dose response models, we work mainly with the exponential model and the beta-poisson model.

**Beta-poisson model:**\n
The equation used for the Beta-poisson model is the following:
$$
1-\left(1+\frac{dose}{\beta}\right)^{-\alpha}
$$
This was impemented in the code as following:
```{r}
response_beta_poisson_rota = 1-(1+subset(df, rownames(df) == "rota_triangular", select = "number_pathogens_ingested")/(0.42))^(-0.26)
cat("Risk of infection by rotavirus, with mode of triangular distribution:", response_beta_poisson_rota[[1]], "\n")

response_beta_poisson_rota = 1-(1+subset(df, rownames(df) == "rota_normal", select = "number_pathogens_ingested")/(0.42))^(-0.26)
cat("Risk of infection by rotavirus, with mean of normal distribution:", response_beta_poisson_rota[[1]], "\n")

response_beta_poisson_campylo1996 = 1-(1+subset(df, rownames(df) == "campylo", select = "number_pathogens_ingested")/(7.59))^(-0.145)
cat("Risk of infection by Campylobacter, using the parameters the study of 1996:", response_beta_poisson_campylo1996[[1]], "\n")

response_beta_poisson_campylo2005 = 1-(1+subset(df, rownames(df) == "campylo", select = "number_pathogens_ingested")/(0.011))^(-0.024)
cat("Risk of infection by Campylobacter, using the parameters of the study of 2005:", response_beta_poisson_campylo2005[[1]], "\n")

response_beta_poisson_EHEC <- 1-(1+subset(df, rownames(df) == "EHEC", select = "number_pathogens_ingested")/(39.71))^(-0.373)
cat("Risk of infection by EHEC:", response_beta_poisson_campylo2005[[1]], "\n")

```

**Exponential model:**\n
The equation used for the exponential model was the following:
$$
1 - \exp(-r \times \text{dose})
$$
This was implemented in the code as following:
```{r}
response_exponential_adeno <- 1 - exp(-4.172 * 10^(-1) * subset(df, rownames(df) == "adeno", select = "number_pathogens_ingested"))
cat("Risk of infection by adenovirus:", response_exponential_adeno[[1]], "\n")

response_exponential_crypto1 = 1-exp(-0.0042*subset(df, rownames(df) == "crypto_triangular", select = "number_pathogens_ingested")) 
cat("Risk of infection by cryptosporidium:", response_exponential_crypto1[[1]], "\n")

response_exponential_crypto2 = 1-exp(-0.0042*subset(df, rownames(df) == "crypto_normal", select = "number_pathogens_ingested")) 
cat("Risk of infection by cryptosporidium:", response_exponential_crypto2[[1]], "\n")

response_exponential_giardia <- 1-exp(-0.0198*subset(df, rownames(df) == "giardia", select = "number_pathogens_ingested")) 
cat("Risk of infection by giardia:", response_exponential_giardia[[1]], "\n")

```




